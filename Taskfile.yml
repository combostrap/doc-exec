version: '3'

tasks:
  # Update this repo with the copier-template
  # `--vcs-ref HEAD` to avoid `You are downgrading from 0.1.0.post2.dev0+0a9a33e to 0.1.0. Downgrades are not supported.`
  update:
    cmds:
      - |
        copier update --vcs-ref HEAD .
  # Install the package locally
  # * -DskipTests and not -Dmaven.test.skip so that test packaging is not skipped
  # * use --update-snapshots if the dependency pom was changed
  install:
    cmds:
      - ./mvnw install -DskipTests
  # Quick check to get all java docs error/warning
  # grep "error" to see only the errors
  javadoc:
    cmds:
      - ./mvnw javadoc:javadoc -q
  package:
    # -DskipTests and not -Dmaven.test.skip so that test packaging is not skipped
    cmds:
      - mvnw package -DskipTests
  # Run tests slow excluded (by default)
  test:
    cmds:
      # -P for profile name
      - |
        mvnw test -P default
  # Run all tests
  test-all:
    cmds:
      # -P for profile name
      - |
        mvnw test -P all-tests
  # Run slow tests
  test-slow:
    cmds:
      # -P for profile name
      - |
        mvnw test -P slow-tests-only
  # Install doc-exec locally
  # The task `install` command install the jars, this one install the cli
  install-cli:
    cmds:
      - |
        {{.TASKFILE_DIR}}/contrib/script/install-cli
  # Install the jars in the cli
  install-cli-jars:
    cmds:
      - |
        {{.TASKFILE_DIR}}/contrib/script/install-cli-jars
  # Release the actual version
  maven-prepare:
    cmds:
      - |
        mvnw -Ppublication --no-transfer-progress --batch-mode
